<mxfile host="app.diagrams.net" modified="2024-01-15T00:00:00.000Z" agent="5.0" version="21.0.0" etag="diagram" type="device">
  <diagram name="Buddy Service Architecture" id="buddy-architecture">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2000" pageHeight="1400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Buddy Service - Low Level Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="20" width="800" height="40" as="geometry" />
        </mxCell>
        
        <!-- Presentation Layer -->
        <mxCell id="presentation-layer" value="Presentation Layer" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="50" y="100" width="300" height="120" as="geometry" />
        </mxCell>
        <mxCell id="chat-controller" value="ChatController&#xa;@RestController&#xa;/api/v1/chat" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="presentation-layer">
          <mxGeometry y="40" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="exception-handler" value="GlobalExceptionHandler&#xa;@ControllerAdvice" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="presentation-layer">
          <mxGeometry y="80" width="300" height="40" as="geometry" />
        </mxCell>
        
        <!-- Service Layer -->
        <mxCell id="service-layer" value="Service Layer" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="50" y="280" width="300" height="200" as="geometry" />
        </mxCell>
        <mxCell id="chat-service" value="ChatService&#xa;@Service&#xa;processMessage()&#xa;getConversations()" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="service-layer">
          <mxGeometry y="40" width="300" height="60" as="geometry" />
        </mxCell>
        <mxCell id="chromadb-service" value="ChromaDbService&#xa;@Service&#xa;RAG Operations" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="service-layer">
          <mxGeometry y="100" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="embedding-service" value="EmbeddingService&#xa;@Service&#xa;generateEmbedding()" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="service-layer">
          <mxGeometry y="140" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="document-training" value="DocumentTrainingService&#xa;@Service" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="service-layer">
          <mxGeometry y="180" width="300" height="20" as="geometry" />
        </mxCell>
        
        <!-- AI Layer -->
        <mxCell id="ai-layer" value="AI Layer (LangChain4j)" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="450" y="100" width="400" height="380" as="geometry" />
        </mxCell>
        <mxCell id="buddy-assistant" value="BuddyAssistant&#xa;@AiService&#xa;chat() - Main Interface" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="ai-layer">
          <mxGeometry y="40" width="400" height="40" as="geometry" />
        </mxCell>
        <mxCell id="custom-chat-model" value="CustomChatLanguageModel&#xa;ChatLanguageModel&#xa;generate() - Tool Calling Support" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="ai-layer">
          <mxGeometry y="80" width="400" height="50" as="geometry" />
        </mxCell>
        <mxCell id="custom-embedding-model" value="CustomEmbeddingModel&#xa;EmbeddingModel&#xa;embed() - Custom API Wrapper" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="ai-layer">
          <mxGeometry y="130" width="400" height="50" as="geometry" />
        </mxCell>
        <mxCell id="chromadb-embedding-store" value="ChromaDbEmbeddingStore&#xa;EmbeddingStore&lt;TextSegment&gt;&#xa;RAG Integration" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="ai-layer">
          <mxGeometry y="180" width="400" height="50" as="geometry" />
        </mxCell>
        <mxCell id="content-retriever" value="EmbeddingStoreContentRetriever&#xa;ContentRetriever&#xa;RAG Context Retrieval" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="ai-layer">
          <mxGeometry y="230" width="400" height="50" as="geometry" />
        </mxCell>
        <mxCell id="chat-memory" value="MessageWindowChatMemory&#xa;Conversation History&#xa;Last 10 Messages" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="ai-layer">
          <mxGeometry y="280" width="400" height="50" as="geometry" />
        </mxCell>
        <mxCell id="langchain-config" value="LangChain4jConfig&#xa;@Configuration&#xa;Bean Definitions" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="ai-layer">
          <mxGeometry y="330" width="400" height="50" as="geometry" />
        </mxCell>
        
        <!-- Tool Layer -->
        <mxCell id="tool-layer" value="Tool Layer (Agents)" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="950" y="100" width="300" height="160" as="geometry" />
        </mxCell>
        <mxCell id="access-request-tool" value="AccessRequestTool&#xa;@Component @Tool&#xa;createAccessRequest()" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="tool-layer">
          <mxGeometry y="40" width="300" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mentor-matching-tool" value="MentorMatchingTool&#xa;@Component @Tool&#xa;findMentors()&#xa;selectMentor()" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="tool-layer">
          <mxGeometry y="90" width="300" height="70" as="geometry" />
        </mxCell>
        
        <!-- Data Layer -->
        <mxCell id="data-layer" value="Data Layer" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="50" y="540" width="300" height="120" as="geometry" />
        </mxCell>
        <mxCell id="message-repository" value="MessageRepository&#xa;JpaRepository&lt;Message&gt;&#xa;CRUD Operations" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="data-layer">
          <mxGeometry y="40" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="message-entity" value="Message Entity&#xa;@Entity&#xa;JPA Model" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="data-layer">
          <mxGeometry y="80" width="300" height="40" as="geometry" />
        </mxCell>
        
        <!-- External Services -->
        <mxCell id="external-services" value="External Services" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1350" y="100" width="300" height="200" as="geometry" />
        </mxCell>
        <mxCell id="custom-llm-api" value="Custom LLM API&#xa;OpenAI-Compatible&#xa;Tool Calling Support" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="external-services">
          <mxGeometry y="40" width="300" height="50" as="geometry" />
        </mxCell>
        <mxCell id="custom-embedding-api" value="Custom Embedding API&#xa;OpenAI-Compatible" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="external-services">
          <mxGeometry y="90" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="chromadb" value="ChromaDB&#xa;Vector Database&#xa;RAG Storage" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="external-services">
          <mxGeometry y="130" width="300" height="50" as="geometry" />
        </mxCell>
        <mxCell id="postgresql" value="PostgreSQL&#xa;Relational Database&#xa;Message Storage" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="external-services">
          <mxGeometry y="180" width="300" height="50" as="geometry" />
        </mxCell>
        
        <!-- Flow Arrows -->
        <!-- Controller to Service -->
        <mxCell id="arrow1" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="chat-controller" target="chat-service">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="300" as="sourcePoint" />
            <mxPoint x="250" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Service to AI -->
        <mxCell id="arrow2" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="chat-service" target="buddy-assistant">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="300" as="sourcePoint" />
            <mxPoint x="450" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- AI to Custom Models -->
        <mxCell id="arrow3" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="buddy-assistant" target="custom-chat-model">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="650" y="200" as="sourcePoint" />
            <mxPoint x="700" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Custom Chat Model to LLM API -->
        <mxCell id="arrow4" value="HTTP" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#d79b00;" edge="1" parent="1" source="custom-chat-model" target="custom-llm-api">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="200" as="sourcePoint" />
            <mxPoint x="950" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Custom Embedding Model to Embedding API -->
        <mxCell id="arrow5" value="HTTP" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#d79b00;" edge="1" parent="1" source="custom-embedding-model" target="custom-embedding-api">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="200" as="sourcePoint" />
            <mxPoint x="950" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- ChromaDbEmbeddingStore to ChromaDB -->
        <mxCell id="arrow6" value="HTTP" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#d79b00;" edge="1" parent="1" source="chromadb-embedding-store" target="chromadb">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="200" as="sourcePoint" />
            <mxPoint x="950" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- ChromaDbService to ChromaDB -->
        <mxCell id="arrow7" value="HTTP" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#d79b00;" edge="1" parent="1" source="chromadb-service" target="chromadb">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="1350" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Service to Repository -->
        <mxCell id="arrow8" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="chat-service" target="message-repository">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="500" as="sourcePoint" />
            <mxPoint x="250" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Repository to PostgreSQL -->
        <mxCell id="arrow9" value="JDBC" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#d79b00;" edge="1" parent="1" source="message-repository" target="postgresql">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="600" as="sourcePoint" />
            <mxPoint x="1350" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- AI to Tools -->
        <mxCell id="arrow10" value="Tool Call" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#b85450;dashed=1;" edge="1" parent="1" source="buddy-assistant" target="access-request-tool">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="200" as="sourcePoint" />
            <mxPoint x="950" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow11" value="Tool Call" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#b85450;dashed=1;" edge="1" parent="1" source="buddy-assistant" target="mentor-matching-tool">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="200" as="sourcePoint" />
            <mxPoint x="950" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Content Retriever to Embedding Store -->
        <mxCell id="arrow12" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="content-retriever" target="chromadb-embedding-store">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="650" y="300" as="sourcePoint" />
            <mxPoint x="700" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Embedding Store to Embedding Model -->
        <mxCell id="arrow13" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="chromadb-embedding-store" target="custom-embedding-model">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="650" y="200" as="sourcePoint" />
            <mxPoint x="700" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Legend -->
        <mxCell id="legend" value="Legend" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1350" y="360" width="300" height="300" as="geometry" />
        </mxCell>
        <mxCell id="legend-http" value="HTTP Request" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#d79b00;strokeWidth=2;dashed=0;" vertex="1" parent="legend">
          <mxGeometry y="30" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-jdbc" value="JDBC Connection" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#d79b00;strokeWidth=2;dashed=0;" vertex="1" parent="legend">
          <mxGeometry y="60" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-internal" value="Internal Call" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#666666;strokeWidth=2;dashed=0;" vertex="1" parent="legend">
          <mxGeometry y="90" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-tool" value="Tool Call (Agent)" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#b85450;strokeWidth=2;dashed=1;" vertex="1" parent="legend">
          <mxGeometry y="120" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-presentation" value="Presentation Layer" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=1;" vertex="1" parent="legend">
          <mxGeometry y="150" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-service" value="Service Layer" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=1;" vertex="1" parent="legend">
          <mxGeometry y="180" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-ai" value="AI Layer" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=1;" vertex="1" parent="legend">
          <mxGeometry y="210" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-tool-layer" value="Tool Layer" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=1;" vertex="1" parent="legend">
          <mxGeometry y="240" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-data" value="Data Layer" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=1;" vertex="1" parent="legend">
          <mxGeometry y="270" width="300" height="30" as="geometry" />
        </mxCell>
        
        <!-- Flow Description -->
        <mxCell id="flow-description" value="Request Flow:&#xa;1. Client → ChatController&#xa;2. ChatController → ChatService&#xa;3. ChatService → BuddyAssistant&#xa;4. BuddyAssistant → CustomChatLanguageModel (with Tools)&#xa;5. CustomChatLanguageModel → Custom LLM API&#xa;6. LLM Response → Tool Execution (if needed)&#xa;7. Tool Results → LLM → Response&#xa;8. ChatService → MessageRepository → PostgreSQL&#xa;&#xa;RAG Flow:&#xa;1. BuddyAssistant → ContentRetriever&#xa;2. ContentRetriever → ChromaDbEmbeddingStore&#xa;3. ChromaDbEmbeddingStore → CustomEmbeddingModel → Embedding API&#xa;4. ChromaDbEmbeddingStore → ChromaDB (Search)&#xa;5. Results → BuddyAssistant" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="450" y="540" width="400" height="200" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

