<mxfile host="app.diagrams.net" modified="2024-01-15T00:00:00.000Z" agent="5.0" version="21.0.0" etag="high-level" type="device">
  <diagram name="High Level Architecture" id="high-level-arch">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2000" pageHeight="1600" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Buddy Service - High Level Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="1000" height="40" as="geometry" />
        </mxCell>
        
        <!-- User -->
        <mxCell id="user" value="ðŸ‘¤ User&#xa;(Frontend)" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="100" y="100" width="80" height="120" as="geometry" />
        </mxCell>
        
        <!-- API Gateway / REST Layer -->
        <mxCell id="api-layer" value="REST API Layer&#xa;/api/v1/chat" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="300" y="120" width="200" height="80" as="geometry" />
        </mxCell>
        
        <!-- Business Logic Layer -->
        <mxCell id="business-layer" value="Business Logic Layer&#xa;ChatService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="300" y="250" width="200" height="80" as="geometry" />
        </mxCell>
        
        <!-- AI Decision Point -->
        <mxCell id="ai-decision" value="AI Decision Point&#xa;RAG vs Agent?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="300" y="380" width="200" height="100" as="geometry" />
        </mxCell>
        
        <!-- RAG Path -->
        <mxCell id="rag-path" value="RAG Mode&#xa;Information Retrieval" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="100" y="540" width="180" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="rag-components" value="ContentRetriever&#xa;â†“&#xa;ChromaDB EmbeddingStore&#xa;â†“&#xa;ChromaDB (Vector Search)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="100" y="660" width="180" height="120" as="geometry" />
        </mxCell>
        
        <!-- Agent Path -->
        <mxCell id="agent-path" value="Agent Mode&#xa;Action Execution" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="420" y="540" width="180" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="agent-components" value="Tool Execution&#xa;â†“&#xa;AccessRequestTool&#xa;MentorMatchingTool" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="420" y="660" width="180" height="120" as="geometry" />
        </mxCell>
        
        <!-- LLM Core -->
        <mxCell id="llm-core" value="LLM Core&#xa;BuddyAssistant&#xa;CustomChatLanguageModel" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="300" y="820" width="200" height="80" as="geometry" />
        </mxCell>
        
        <!-- Memory -->
        <mxCell id="memory" value="Conversation Memory&#xa;MessageWindowChatMemory&#xa;(Last 10 messages)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="100" y="820" width="180" height="80" as="geometry" />
        </mxCell>
        
        <!-- External Services -->
        <mxCell id="external-llm" value="Custom LLM API&#xa;(OpenAI-Compatible)&#xa;Tool Calling Support" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="300" y="960" width="200" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="external-embedding" value="Custom Embedding API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="100" y="960" width="180" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="chromadb" value="ChromaDB&#xa;Vector Database" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="100" y="1060" width="180" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="postgresql" value="PostgreSQL&#xa;Message Storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="300" y="1100" width="200" height="60" as="geometry" />
        </mxCell>
        
        <!-- Flow Arrows -->
        <!-- User to API -->
        <mxCell id="flow1" value="HTTP Request" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="user" target="api-layer">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="200" as="sourcePoint" />
            <mxPoint x="250" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- API to Business -->
        <mxCell id="flow2" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="api-layer" target="business-layer">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="250" as="sourcePoint" />
            <mxPoint x="450" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Business to Decision -->
        <mxCell id="flow3" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="business-layer" target="ai-decision">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Decision to RAG -->
        <mxCell id="flow4" value="Question?" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#9673a6;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="ai-decision" target="rag-path">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="500" as="sourcePoint" />
            <mxPoint x="250" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Decision to Agent -->
        <mxCell id="flow5" value="Action?" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#b85450;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="ai-decision" target="agent-path">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="500" as="sourcePoint" />
            <mxPoint x="650" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- RAG to Components -->
        <mxCell id="flow6" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#9673a6;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="rag-path" target="rag-components">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="700" as="sourcePoint" />
            <mxPoint x="250" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Agent to Components -->
        <mxCell id="flow7" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#b85450;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="agent-path" target="agent-components">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="700" as="sourcePoint" />
            <mxPoint x="550" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- RAG to LLM -->
        <mxCell id="flow8" value="Context" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#9673a6;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="rag-components" target="llm-core">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="800" as="sourcePoint" />
            <mxPoint x="450" y="750" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Agent to LLM -->
        <mxCell id="flow9" value="Tool Result" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#b85450;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="agent-components" target="llm-core">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="800" as="sourcePoint" />
            <mxPoint x="400" y="800" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Decision to LLM -->
        <mxCell id="flow10" value="Query" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="ai-decision" target="llm-core">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="600" as="sourcePoint" />
            <mxPoint x="400" y="800" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Memory to LLM -->
        <mxCell id="flow11" value="History" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#d79b00;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="memory" target="llm-core">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="900" as="sourcePoint" />
            <mxPoint x="450" y="850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- LLM to External LLM -->
        <mxCell id="flow12" value="HTTP" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#d79b00;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="llm-core" target="external-llm">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="1000" as="sourcePoint" />
            <mxPoint x="450" y="950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- RAG Components to Embedding API -->
        <mxCell id="flow13" value="HTTP" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#d79b00;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="rag-components" target="external-embedding">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="900" as="sourcePoint" />
            <mxPoint x="250" y="850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- RAG Components to ChromaDB -->
        <mxCell id="flow14" value="HTTP" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#d79b00;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="rag-components" target="chromadb">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="1100" as="sourcePoint" />
            <mxPoint x="250" y="1050" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Business to PostgreSQL -->
        <mxCell id="flow15" value="JDBC" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#d79b00;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="business-layer" target="postgresql">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="400" y="1100" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Response Flow -->
        <mxCell id="flow16" value="Response" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#82b366;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;" edge="1" parent="1" source="llm-core" target="business-layer">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="800" as="sourcePoint" />
            <mxPoint x="400" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- System Decision Flow -->
        <mxCell id="decision-flow" value="Decision Flow" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="650" y="100" width="500" height="300" as="geometry" />
        </mxCell>
        <mxCell id="decision-step1" value="1. User sends message" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="decision-flow">
          <mxGeometry y="30" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="decision-step2" value="2. System analyzes intent (Question vs Action)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="decision-flow">
          <mxGeometry y="60" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="decision-step3a" value="3a. If QUESTION â†’ RAG Mode:" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=1" vertex="1" parent="decision-flow">
          <mxGeometry y="90" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="decision-step3a-detail" value="   - Retrieve relevant context from ChromaDB&#xa;   - Generate embedding for query&#xa;   - Search similar documents&#xa;   - Pass context to LLM" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="decision-flow">
          <mxGeometry y="120" width="500" height="60" as="geometry" />
        </mxCell>
        <mxCell id="decision-step3b" value="3b. If ACTION â†’ Agent Mode:" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=1" vertex="1" parent="decision-flow">
          <mxGeometry y="180" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="decision-step3b-detail" value="   - Collect required parameters from user&#xa;   - Call appropriate tool (AccessRequestTool, MentorMatchingTool)&#xa;   - Execute tool function&#xa;   - Return result to LLM" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="decision-flow">
          <mxGeometry y="210" width="500" height="60" as="geometry" />
        </mxCell>
        <mxCell id="decision-step4" value="4. LLM generates response with context/tool results" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="decision-flow">
          <mxGeometry y="270" width="500" height="30" as="geometry" />
        </mxCell>
        
        <!-- Tool Execution Flow -->
        <mxCell id="tool-flow" value="Tool Execution Flow" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="650" y="450" width="500" height="200" as="geometry" />
        </mxCell>
        <mxCell id="tool-step1" value="1. LLM decides to call tool (e.g., createAccessRequest)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="tool-flow">
          <mxGeometry y="30" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tool-step2" value="2. CustomChatLanguageModel sends tool_calls to LLM API" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="tool-flow">
          <mxGeometry y="60" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tool-step3" value="3. LLM API returns tool execution request (or JSON in content)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="tool-flow">
          <mxGeometry y="90" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tool-step4" value="4. Fallback mechanism parses tool call from response" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="tool-flow">
          <mxGeometry y="120" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tool-step5" value="5. Tool method executes (e.g., AccessRequestTool.createAccessRequest())" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="tool-flow">
          <mxGeometry y="150" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tool-step6" value="6. Tool result returned to LLM for final response generation" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="tool-flow">
          <mxGeometry y="180" width="500" height="20" as="geometry" />
        </mxCell>
        
        <!-- Data Flow -->
        <mxCell id="data-flow" value="Data Persistence Flow" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="650" y="700" width="500" height="120" as="geometry" />
        </mxCell>
        <mxCell id="data-step1" value="1. User message saved to PostgreSQL via MessageRepository" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="data-flow">
          <mxGeometry y="30" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="data-step2" value="2. AI response saved to PostgreSQL" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="data-flow">
          <mxGeometry y="60" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="data-step3" value="3. Conversation history retrieved for context (MessageWindowChatMemory)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="data-flow">
          <mxGeometry y="90" width="500" height="30" as="geometry" />
        </mxCell>
        
        <!-- Key Features -->
        <mxCell id="features" value="Key Features" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="650" y="880" width="500" height="240" as="geometry" />
        </mxCell>
        <mxCell id="feature-rag" value="âœ… RAG (Retrieval-Augmented Generation)&#xa;   - ChromaDB vector search&#xa;   - Context-aware responses&#xa;   - Document-based knowledge" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="features">
          <mxGeometry y="30" width="500" height="50" as="geometry" />
        </mxCell>
        <mxCell id="feature-agent" value="âœ… Agent Mode (Tool Execution)&#xa;   - Portal access requests&#xa;   - Mentor matching&#xa;   - Extensible tool system" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="features">
          <mxGeometry y="80" width="500" height="50" as="geometry" />
        </mxCell>
        <mxCell id="feature-memory" value="âœ… Conversation Memory&#xa;   - Last 10 messages context&#xa;   - Session-based history&#xa;   - Persistent storage" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="features">
          <mxGeometry y="130" width="500" height="50" as="geometry" />
        </mxCell>
        <mxCell id="feature-fallback" value="âœ… Fallback Mechanism&#xa;   - Tool call parsing from content&#xa;   - Multiple format support&#xa;   - LLM compatibility layer" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="features">
          <mxGeometry y="180" width="500" height="50" as="geometry" />
        </mxCell>
        <mxCell id="feature-custom" value="âœ… Custom LLM Integration&#xa;   - OpenAI-compatible API wrapper&#xa;   - Tool calling support&#xa;   - Token usage tracking" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;fontStyle=0" vertex="1" parent="features">
          <mxGeometry y="230" width="500" height="10" as="geometry" />
        </mxCell>
        
        <!-- Legend -->
        <mxCell id="legend-box" value="Legend" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="650" y="1180" width="500" height="200" as="geometry" />
        </mxCell>
        <mxCell id="legend-rag" value="RAG Flow" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#9673a6;strokeWidth=2;dashed=0;" vertex="1" parent="legend-box">
          <mxGeometry y="30" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-agent" value="Agent/Tool Flow" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#b85450;strokeWidth=2;dashed=0;" vertex="1" parent="legend-box">
          <mxGeometry y="60" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-internal" value="Internal Flow" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#666666;strokeWidth=2;dashed=0;" vertex="1" parent="legend-box">
          <mxGeometry y="90" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-external" value="External Service (HTTP/JDBC)" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#d79b00;strokeWidth=2;dashed=0;" vertex="1" parent="legend-box">
          <mxGeometry y="120" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-response" value="Response Flow" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#82b366;strokeWidth=2;dashed=1;" vertex="1" parent="legend-box">
          <mxGeometry y="150" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-memory" value="Memory/History Flow" style="shape=partialRectangle;top=0;left=0;bottom=0;right=0;fillColor=none;strokeColor=#d79b00;strokeWidth=2;dashed=0;" vertex="1" parent="legend-box">
          <mxGeometry y="180" width="500" height="20" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

